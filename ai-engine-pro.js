"use strict";const AIEnginePro={version:"1.6.9",_okrtBuild:"nomerge-cap",isReady:!1,db:null,config:{horizons:[2,5,10,15,30,60,120,240],minConfidence:.3,ensembleThreshold:.4,learningRate:.03,decayRate:.995,maxLongTermPatterns:2e3,maxMarketCycles:100,optimizationInterval:36e5,featureThreshold:.1,minValidationsToLearn:6,autoMaxHorizon:15,minValidationsToLearnAuto:4,maxPending:25,sessionAware:!0,volatilityAware:!0,breakoutAware:!0,debugMode:!0},models:{momentum:{name:"Momentum",weight:1,accuracy:.5,features:["rsi","stoch_rsi","momentum","rsi_divergence","price_momentum"],predictions:0,correct:0},trend:{name:"Trend",weight:1,accuracy:.5,features:["ema_cross","macd","adx","supertrend","price_momentum"],predictions:0,correct:0},volume:{name:"Volume",weight:1,accuracy:.5,features:["volume","obv","cvd","whale_flow"],predictions:0,correct:0},structure:{name:"Structure",weight:1,accuracy:.5,features:["support_resistance","order_blocks","fvg","liquidity"],predictions:0,correct:0},patterns:{name:"Patterns",weight:1,accuracy:.5,features:["candlestick_patterns","chart_patterns","divergences","price_momentum"],predictions:0,correct:0},mtf:{name:"MTF",weight:1.2,accuracy:.5,features:["mtf_1m","mtf_5m","mtf_15m","mtf_1h","mtf_4h"],predictions:0,correct:0}},features:{derived:{rsi_momentum:{weight:1,formula:"rsi_change_rate"},macd_acceleration:{weight:1,formula:"macd_histogram_change"},volume_trend:{weight:1,formula:"volume_ma_ratio"},volatility_regime:{weight:1,formula:"atr_percentile"},whale_pressure:{weight:1.2,formula:"whale_buy_sell_ratio"},order_imbalance:{weight:1.1,formula:"bid_ask_imbalance"},mtf_alignment:{weight:1.3,formula:"timeframe_confluence"},trend_strength:{weight:1,formula:"adx_slope"},momentum_divergence:{weight:1.2,formula:"price_rsi_divergence"},liquidity_zones:{weight:1.1,formula:"nearby_liquidity"}},stats:{}},predictions:{pending:[],completed:[],byHorizon:{2:{total:0,correct:0,accuracy:.5},5:{total:0,correct:0,accuracy:.5},10:{total:0,correct:0,accuracy:.5},15:{total:0,correct:0,accuracy:.5},30:{total:0,correct:0,accuracy:.5},60:{total:0,correct:0,accuracy:.5},120:{total:0,correct:0,accuracy:.5},240:{total:0,correct:0,accuracy:.5}}},memory:{patterns:[],marketCycles:[],correlations:{},regimeHistory:[],significantEvents:[]},performance:{daily:{},weekly:{},overall:{totalPredictions:0,correctPredictions:0,accuracy:0,profitFactor:1,sharpeRatio:0,maxDrawdown:0}},async init(){console.log("[AI-PRO] Initializing AI Engine PRO v"+this.version+" with Auto-Prediction");let e=0;for(;!window.AILearning?.isInitialized&&e<50;)await new Promise(e=>setTimeout(e,100)),e++;return window.AILearning?.isInitialized?(this.db=window.AILearning.db,this.db||console.warn("[AI-PRO] Firestore not available, using local mode"),this.initializeHorizons(),this.validateFeatures(),await this.loadState(),this.startOptimizationLoop(),this.hookIntoBase(),this.startAutoPrediction(),this._sessionStart=Date.now(),this._sessionPredictions=0,this._lastPredictionTime=null,this._lastVerification=null,this.isReady=!0,console.log("[AI-PRO] âœ“ AI Engine PRO ready"),console.log("[AI-PRO] Models:",Object.keys(this.models).length),console.log("[AI-PRO] Features:",Object.keys(this.features.derived).length),console.log("[AI-PRO] Horizons:",this.config.horizons.join(", ")+" min"),console.log("[AI-PRO] Min confidence:",100*this.config.minConfidence+"%"),console.log("[AI-PRO] Ensemble threshold:",100*this.config.ensembleThreshold+"%"),setTimeout(()=>{const e=window.state||{};console.log("[AI-PRO] ðŸ“Š State check:",{price:e.price,hasIndicators:!!e.indicators,indicatorCount:Object.keys(e.indicators||{}).length,indicatorSample:Object.keys(e.indicators||{}).slice(0,8)})},3e3),!0):(console.error("[AI-PRO] Base AILearning not ready"),!1)},initializeHorizons(){for(const e of this.config.horizons)this.predictions.byHorizon[e]||(this.predictions.byHorizon[e]={total:0,correct:0,accuracy:.5},console.log(`[AI-PRO] Initialized horizon: ${e}min`))},validateFeatures(){const e=new Set;for(const t of Object.values(this.models))t.features.forEach(t=>e.add(t));Object.keys(this.features.derived).forEach(t=>e.add(t));const t=[],i=[];for(const n of e)this.hasFeatureMapping(n)?t.push(n):i.push(n);this.config.debugMode&&(console.log(`[AI-PRO] Features mapped: ${t.length}/${e.size}`),i.length>0&&console.warn("[AI-PRO] Unmapped features:",i.join(", ")))},hasFeatureMapping:e=>["rsi","stoch_rsi","momentum","rsi_divergence","price_momentum","ema_cross","macd","adx","supertrend","volume","obv","cvd","whale_flow","support_resistance","order_blocks","fvg","liquidity","candlestick_patterns","chart_patterns","divergences","mtf_1m","mtf_5m","mtf_15m","mtf_1h","mtf_4h","rsi_momentum","macd_acceleration","volume_trend","volatility_regime","whale_pressure","order_imbalance","mtf_alignment","trend_strength","momentum_divergence","liquidity_zones"].includes(e),hookIntoBase(){const e=window.AILearning.recordPrediction.bind(window.AILearning),t=window.AILearning.complete.bind(window.AILearning);window.AILearning.recordPrediction=t=>{const i=e(t);return this.recordProPrediction(t,i),i},window.AILearning.complete=e=>{t(e),this.updateProModels(e)},console.log("[AI-PRO] Hooked into base AILearning")},generateEnsemblePrediction(e){const t={BULL:0,BEAR:0,NEUTRAL:0},i={};let n=0;for(const[r,o]of Object.entries(this.models)){const s=this.getModelPrediction(r,o,e);i[r]=s;const c=o.weight*o.accuracy;t[s.direction]+=c*s.confidence,n+=c}for(const e of Object.keys(t))t[e]=n>0?t[e]/n:.33;let r="NEUTRAL",o=.35;const s=Math.max(t.BULL,t.BEAR,t.NEUTRAL);t.BULL>=t.BEAR&&t.BULL>=.8*t.NEUTRAL?(r="BULL",o=.35+.6*t.BULL):t.BEAR>=t.BULL&&t.BEAR>=.8*t.NEUTRAL?(r="BEAR",o=.35+.6*t.BEAR):o=.3+.3*s;const c=this.config.sessionAware?this.getSessionContext():null,a=this.config.volatilityAware?this.getVolatilityScore(e):null,l=null!=a?this.getVolatilityConfidenceMultiplier(a):1,u=this.config.breakoutAware?this.detectBreakoutContext(e):null,d=this.detectMarketRegime(e);o*=this.getRegimeConfidenceMultiplier(d),c&&(o*=this.getSessionConfidenceMultiplier(c)),o*=l,u&&"FAKE_BREAKOUT_RISK"===u.classification&&(o*=.92);const h=this.queryLongTermMemory(e);return h.found&&(o=(o+h.confidence)/2,h.direction!==r&&h.confidence>.7&&(o*=.85)),o=Math.max(.2,Math.min(.95,o)),{direction:r,confidence:o,votes:t,modelPredictions:i,regime:d,patternMatch:h,session:c,volScore:a,breakout:u,timestamp:Date.now()}},getModelPrediction(e,t,i){let n=0,r=0,o=0;for(const e of t.features){const t=this.getFeatureValue(e,i);if(null==t)continue;const s=window.AILearning?.getWeight?.(e)||1;t>0?n+=t*s:t<0&&(r+=Math.abs(t)*s),o++}if(0===o){const e=this.getFeatureValue("price_momentum",i)||0;return e>.01?{direction:"BULL",confidence:.4+.3*e,featureCount:1}:e<-.01?{direction:"BEAR",confidence:.4+.3*Math.abs(e),featureCount:1}:{direction:"NEUTRAL",confidence:.35,featureCount:0}}const s=n+r;if(0===s)return{direction:"NEUTRAL",confidence:.4,featureCount:o};const c=n/s,a=r/s;let l="NEUTRAL",u=.4;return c>.52?(l="BULL",u=.4+1.2*(c-.5)):a>.52&&(l="BEAR",u=.4+1.2*(a-.5)),{direction:l,confidence:Math.min(.95,u),featureCount:o}},getFeatureValue(e,t){const i=t.indicators||{},n=t,r={rsi:()=>((i.rsi?.value??i.rsi??50)-50)/50,stoch_rsi:()=>((i.stochRsi?.value??i.stochRsi??50)-50)/50,momentum:()=>{const e=i.momentum;return e?"bull"===e.signal?1:"bear"===e.signal?-1:0:0},rsi_divergence:()=>{const e=i.divergence||n.divergence;return e?"bullish"===e.type?1:"bearish"===e.type?-1:0:0},ema_cross:()=>{const e=i.ema;return e?"bull"===e.signal?1:"bear"===e.signal?-1:0:0},macd:()=>{const e=i.macd;if(!e)return 0;const t=e.histogram??e.hist??0;return t>0?Math.min(1,10*t):Math.max(-1,10*t)},adx:()=>{const e=i.adx;if(!e)return 0;const t=(e.value??e.adx??20)>25?1:.5;return"bull"===e.trend?t:"bear"===e.trend?-t:0},supertrend:()=>{const e=i.supertrend;return e?"bull"===e.signal?1:"bear"===e.signal?-1:0:0},volume:()=>{const e=n.volume||{};return"increasing"===e.trend?.5:"decreasing"===e.trend?-.5:0},obv:()=>{const e=i.obv;return e?"bull"===e.signal?1:"bear"===e.signal?-1:0:0},cvd:()=>{const e=n.cvd??0;return Math.tanh(e/1e6)},whale_flow:()=>{const e=n.whaleFlow||{buy:0,sell:0},t=(e.buy||0)-(e.sell||0);return Math.tanh(t/1e5)},support_resistance:()=>{const e=n.supportResistance||{};return e.nearSupport?.7:e.nearResistance?-.7:0},order_blocks:()=>{const e=n.orderBlocks||{};return e.bullish?.5:e.bearish?-.5:0},fvg:()=>{const e=n.fvg||{};return e.bullish?.3:e.bearish?-.3:0},liquidity:()=>{const e=n.liquidity||{},t=e.buyLiquidity||e.buy||0,i=e.sellLiquidity||e.sell||0;return 0===t&&0===i?0:t>i?.4:-.4},candlestick_patterns:()=>{const e=n.patterns||[];let t=0;return e.forEach(e=>{"bullish"!==e.type&&"bullish"!==e.bias||(t+=.3),"bearish"!==e.type&&"bearish"!==e.bias||(t-=.3)}),Math.max(-1,Math.min(1,t))},chart_patterns:()=>{const e=n.chartPattern;return e?"bullish"===e.bias?.6:"bearish"===e.bias?-.6:0:0},divergences:()=>{const e=n.divergence||i.divergence;return e?"bullish"===e.type?.8:"bearish"===e.type?-.8:0:0},mtf_1m:()=>this.getMTFValue(n,"1m"),mtf_5m:()=>this.getMTFValue(n,"5m"),mtf_15m:()=>this.getMTFValue(n,"15m"),mtf_1h:()=>this.getMTFValue(n,"1h"),mtf_4h:()=>this.getMTFValue(n,"4h"),rsi_momentum:()=>{const e=i.rsi?.value??50,t=i.rsi?.prev??e;return Math.tanh((e-t)/10)},macd_acceleration:()=>{const e=i.macd;if(!e)return 0;const t=e.histogram??0,n=e.prevHistogram??t;return Math.tanh(20*(t-n))},volume_trend:()=>{const e=n.volume||{},t=e.ratio??e.volumeRatio??1;return Math.tanh(2*(t-1))},volatility_regime:()=>{const e=n.atr??0,t=n.atrAvg??e;return 0===t?0:Math.tanh(2*(e/t-1))},whale_pressure:()=>{const e=n.whaleFlow||{buy:0,sell:0},t=(e.buy||0)-(e.sell||0),i=(e.buy||0)+(e.sell||0);return 0===i?0:t/i},order_imbalance:()=>{const e=n.orderbook||n.depth||{},t=e.bidVolume??e.bids??0,i=e.askVolume??e.asks??0,r=t+i;return 0===r?0:(t-i)/r},mtf_alignment:()=>{const e=n.mtf||{};let t=0,i=0,r=0;for(const n of["1m","5m","15m","1h","4h"]){const o=e[n]?.signal;"bull"===o?(t++,r++):"bear"===o?(i++,r++):o&&r++}return 0===r?0:(t-i)/r},trend_strength:()=>{const e=i.adx;if(!e)return 0;const t=e.value??20,n=(t-(e.prev??t))/10;return("bull"===e.trend?1:"bear"===e.trend?-1:0)*Math.min(1,t/40)*(1+n)},momentum_divergence:()=>{const e=n.divergence||i.divergence;if(e)return"bullish"===e.type?.9:"bearish"===e.type?-.9:0;const t=i.rsi?.value??50,r=n.price??0,o=n.prevPrice??r;return r>o&&t<40?.5:r<o&&t>60?-.5:0},liquidity_zones:()=>{const e=n.liquidity||{},t=e.nearBuyZone??!1,i=e.nearSellZone??!1;return t&&!i?.6:i&&!t?-.6:0}};if("price_momentum"===e){const e=n.price||0,t=n.prevPrice||e;if(e>0&&t>0){const i=(e-t)/t;return Math.tanh(100*i)}return 0}const o=r[e];if(o)try{return o()}catch(t){return this.config.debugMode&&console.warn(`[AI-PRO] Feature error: ${e}`,t.message),null}return null},getMTFValue(e,t){const i=(e.mtf||{})[t];return i?"bull"===i.signal?1:"bear"===i.signal?-1:0:0},detectMarketRegime(e){const t=e.indicators||{},i=t.adx?.value??20,n=t.adx?.trend??"neutral",r=e.volatility??"normal",o=e.price??0,s=t.ema?.ema20??o;if("high"===r||e.atr&&e.atrAvg&&e.atr>1.5*e.atrAvg)return"volatile";if(i>25){if("bull"===n||o>s)return"trending_up";if("bear"===n||o<s)return"trending_down"}return"ranging"},getRegimeConfidenceMultiplier:e=>({trending_up:1.1,trending_down:1.1,ranging:.95,volatile:.9}[e]||1),getSessionContext(){const e=(new Date).getUTCHours();return e>=0&&e<8?"ASIA":e>=8&&e<16?"EUROPE":"US"},getSessionConfidenceMultiplier:e=>({ASIA:.95,EUROPE:1.02,US:1.02}[e]||1),getVolatilityScore(e){const t=e.atr,i=e.atrAvg;if(!t||!i||i<=0)return"high"===e.volatility?.85:"low"===e.volatility?.25:.5;const n=t/i;return Math.max(0,Math.min(1,(n-.5)/1.5))},getVolatilityBucket:e=>e>=.75?"HIGH":e<=.35?"LOW":"NORMAL",getVolatilityConfidenceMultiplier:e=>e>=.8?.92:e>=.65?.96:e<=.25?1.02:1,detectBreakoutContext(e){const t=e||{},i=t.price||0,n=t.supportResistance||{},r=t.indicators||{},o=this.getVolatilityScore(t),s=n.resistance||n.r1||n.R1||null,c=n.support||n.s1||n.S1||null,a=r.obv?.value??t.obv,l=t.cvd,u=t.lastCandle||t.candle||null;let d=null;if(u&&null!=u.high&&null!=u.low){const e=Math.max(1e-9,u.high-u.low);d=(e-Math.abs((u.close||0)-(u.open||0)))/e}const h=t.atr||null,m=e=>{if(!e||!i)return null;const t=h&&h>0?h:.002*i;return Math.abs(i-e)/t},g=s?m(s):null,f=c?m(c):null;let p=0,y="NONE";null!=d&&d>.55&&(p+=.25),o>=.75&&(p+=.25),(null!=a&&a<0||null!=l&&l<0)&&(p+=.2),null!=g&&g<1.5&&(p+=.2,y="AT_RESISTANCE"),null!=f&&f<1.5&&(p+=.2,y="AT_SUPPORT"),p=Math.max(0,Math.min(1,p));const b=1-p;let _="NEUTRAL";return p>=.6?_="FAKE_BREAKOUT_RISK":b>=.65&&(null!=g||null!=f)&&(_="CONTINUATION_LIKELY"),{risk:p,quality:b,tag:y,classification:_}},queryLongTermMemory(e){const t=this.detectMarketRegime(e),i=this.extractFeatureVector(e),n=this.config.sessionAware?this.getSessionContext():null,r=this.config.volatilityAware?this.getVolatilityScore(e):null,o=null!=r?this.getVolatilityBucket(r):null;let s=null,c=0;for(const e of this.memory.patterns){if(e.regime!==t)continue;let r=1;n&&e.session&&e.session!==n&&(r*=.9),o&&e.volBucket&&e.volBucket!==o&&(r*=.9);const a=this.calculateSimilarity(i,e.features)*r;a>c&&a>.72&&(c=a,s=e)}return s?{found:!0,confidence:c*s.successRate,direction:s.direction,occurrences:s.occurrences,avgReturn:s.avgReturn,session:s.session||null,volBucket:s.volBucket||null,lastOutcome:s.lastOutcome||null}:{found:!1}},extractFeatureVector(e){const t={},i=new Set;for(const e of Object.values(this.models))e.features.forEach(e=>i.add(e));Object.keys(this.features.derived).forEach(e=>i.add(e));for(const n of i){const i=this.getFeatureValue(n,e);null==i||isNaN(i)||(t[n]=i)}return this.config.debugMode&&0===Object.keys(t).length&&console.warn("[AI-PRO] Empty feature vector - check market state"),t},calculateSimilarity(e,t){const i=Object.keys(e).filter(i=>void 0!==t[i]&&null!==e[i]&&null!==t[i]&&!isNaN(e[i])&&!isNaN(t[i]));if(0===i.length)return 0;let n=0;for(const r of i)n+=1-Math.abs(e[r]-t[r]);return n/i.length},storeInLongTermMemory(e,t){const i=this.config.sessionAware?e.session||this.getSessionContext():null,n=this.config.volatilityAware?e.volScore??this.getVolatilityScore(this.getCurrentMarketState()):null,r=null!=n?this.getVolatilityBucket(n):null,o=e.breakout||null,s={id:Date.now().toString(36),regime:e.regime,direction:e.direction,features:e.features||{},session:i,volBucket:r,breakoutTag:o?.classification||null,successCount:t.success?1:0,failCount:t.success?0:1,successRate:t.success?1:0,occurrences:1,avgReturn:t.priceChange||0,lastOutcome:t.success?"POS":"NEG",timestamp:Date.now()},c=this.memory.patterns.find(e=>e.regime===s.regime&&this.calculateSimilarity(e.features,s.features)>.85);c?(c.occurrences++,c.successCount=(c.successCount||0)+(t.success?1:0),c.failCount=(c.failCount||0)+(t.success?0:1),c.successRate=c.successCount/c.occurrences,c.avgReturn=(c.avgReturn*(c.occurrences-1)+(t.priceChange||0))/c.occurrences,c.timestamp=Date.now(),c.lastOutcome=t.success?"POS":"NEG",i&&(c.session=i),r&&(c.volBucket=r),this.config.debugMode&&console.log(`[AI-PRO] Pattern updated: ${c.id} (${c.occurrences} occ, ${(100*c.successRate).toFixed(1)}% win)`)):(this.memory.patterns.push(s),this.config.debugMode&&console.log(`[AI-PRO] New pattern stored: ${s.id} (${s.direction})`),this.memory.patterns.length>this.config.maxLongTermPatterns&&(this.memory.patterns.sort((e,t)=>{const i=e.successRate*Math.log(e.occurrences+1);return t.successRate*Math.log(t.occurrences+1)-i}),this.memory.patterns=this.memory.patterns.slice(0,this.config.maxLongTermPatterns)))},recordProPrediction(e,t){const i=this.getCurrentMarketState(),n=this.generateEnsemblePrediction(i),r={id:"pro_"+t,baseId:t,timestamp:Date.now(),price:window.state?.price||0,ensemble:n,features:this.extractFeatureVector(i),regime:n.regime,verifications:[],outcome:null};this.predictions.pending.push(r);for(const e of this.config.horizons)setTimeout(()=>this.verifyProPrediction(r.id,e),6e4*e);return n.confidence>.75&&console.log(`[AI-PRO] High confidence ${n.direction}: ${(100*n.confidence).toFixed(1)}%`),r.id},verifyProPrediction(e,t){const i=this.predictions.pending.find(t=>t.id===e);if(!i||!window.state?.price||!i.price)return;const n=(window.state.price-i.price)/i.price*100,r=i.ensemble.direction,o="NEUTRAL"===r?.05:.1,s="BULL"===r&&n>o||"BEAR"===r&&n<-o||"NEUTRAL"===r&&Math.abs(n)<.15;i.verifications.push({horizon:t,priceChange:n,success:s,timestamp:Date.now()}),this._lastVerification={horizon:t,priceChange:n.toFixed(3),success:s,timestamp:Date.now()},this.predictions.byHorizon[t]&&(this.predictions.byHorizon[t].total++,s&&this.predictions.byHorizon[t].correct++,this.predictions.byHorizon[t].accuracy=this.predictions.byHorizon[t].correct/this.predictions.byHorizon[t].total);const c=this.config.autoMaxHorizon||15,a=Math.max(...this.config.horizons);(i.isAuto&&t===c||!i.isAuto&&t===a)&&this.completeProPrediction(i)},rescheduleVerifications(e){if(!e||!e.id||!e.timestamp)return;const t=Date.now(),i=(e.timestamp,e.verifications?e.verifications.map(e=>e.horizon):[]),n=e.isAuto?this.config.horizons.filter(e=>e<=(this.config.autoMaxHorizon||15)):this.config.horizons;for(const r of n){if(i.includes(r))continue;const n=e.timestamp+6e4*r-t;n>0?setTimeout(()=>this.verifyProPrediction(e.id,r),n):n>-3e5&&setTimeout(()=>this.verifyProPrediction(e.id,r),1e3)}},completeProPrediction(e){const t=e.verifications||[],i=Math.min(this.config.minValidationsToLearn,this.config.horizons.length),n=Math.min(this.config.minValidationsToLearnAuto||4,this.config.horizons.length),r=e&&e.isAuto?n:i,o=Math.max(...this.config.horizons);let s=0,c=0,a=0;for(const e of t){const t=.5+e.horizon/o;c+=t,e.success&&(s+=t),a+=e.priceChange}const l=c>0?s/c:0,u=l>=.55,d=t.length?a/t.length:0,h=t.filter(e=>e.success).length;e.outcome={success:u,avgPriceChange:d,successRate:t.length?h/t.length:0,successRateWeighted:l,completedAt:Date.now()},this.updateModelWeights(e,u);const m=e.ensemble?.confidence||0,g=e.ensemble?.breakout;(m>=.7||Math.abs(d)>=.35||g&&"NEUTRAL"!==g.classification)&&t.length>=r&&(e.session=e.ensemble?.session,e.volScore=e.ensemble?.volScore,e.breakout=e.ensemble?.breakout,this.storeInLongTermMemory(e,{success:u,priceChange:d})),this.predictions.completed.push(e),this.predictions.pending=this.predictions.pending.filter(t=>t.id!==e.id),this.updatePerformance(e),this.predictions.completed.length>500&&(this.predictions.completed=this.predictions.completed.slice(-500)),this.performance.overall.totalPredictions%10==0&&this.saveState()},updateModelWeights(e,t){const i=this.config.learningRate;for(const[n,r]of Object.entries(e.ensemble.modelPredictions)){const o=this.models[n];if(!o)continue;const s=t&&r.direction===e.ensemble.direction||!t&&r.direction!==e.ensemble.direction;o.predictions++,s&&o.correct++;const c=o.correct/o.predictions;o.accuracy=.9*o.accuracy+.1*c,o.predictions>=20&&(o.accuracy>.55?o.weight=Math.min(2,o.weight+i):o.accuracy<.45&&(o.weight=Math.max(.3,o.weight-i)))}},updateProModels(e){if(e.outcome?.success)for(const t of Object.keys(e.indicators||{}))for(const e of Object.values(this.models))e.features.includes(t)&&(e.accuracy=.98*e.accuracy+.02)},updatePerformance(e){const t=this.performance.overall;t.totalPredictions++,e.outcome.success&&t.correctPredictions++,t.accuracy=t.correctPredictions/t.totalPredictions;const i=(new Date).toISOString().split("T")[0];this.performance.daily[i]||(this.performance.daily[i]={total:0,correct:0,returns:[]});const n=this.performance.daily[i];n.total++,e.outcome.success&&n.correct++,n.returns.push(e.outcome.avgPriceChange);const r=Object.keys(this.performance.daily).sort();for(;r.length>30;)delete this.performance.daily[r.shift()]},startOptimizationLoop(){setInterval(()=>this.runOptimization(),this.config.optimizationInterval),setTimeout(()=>this.runOptimization(),3e5)},runOptimization(){console.log("[AI-PRO] Running auto-optimization...");const e=this.predictions.completed.slice(-50);if(e.length>=20){const t=e.filter(e=>e.outcome.success).length/e.length;t<.45?this.config.learningRate=Math.min(.1,1.2*this.config.learningRate):t>.6&&(this.config.learningRate=Math.max(.01,.9*this.config.learningRate))}this.memory.patterns=this.memory.patterns.filter(e=>e.occurrences>=3||Date.now()-e.timestamp<864e5);const t=Object.entries(this.predictions.byHorizon).filter(([e,t])=>t.total>=10).sort(([e,t],[i,n])=>n.accuracy-t.accuracy)[0];t&&console.log(`[AI-PRO] Best horizon: ${t[0]}min (${(100*t[1].accuracy).toFixed(1)}%)`),this.saveState(),console.log("[AI-PRO] Optimization complete. Accuracy:",(100*this.performance.overall.accuracy).toFixed(1)+"%"),console.log("[AI-PRO] Memory patterns:",this.memory.patterns.length),console.log("[AI-PRO] Pending predictions:",this.predictions.pending.length)},startAutoPrediction(){setInterval(()=>{this.generateAutoPrediction()},6e4),setTimeout(()=>{console.log("[AI-PRO] ðŸš€ Generating FIRST auto-prediction..."),this.generateAutoPrediction()},5e3),setTimeout(()=>{console.log("[AI-PRO] ðŸš€ Generating SECOND auto-prediction..."),this.generateAutoPrediction()},15e3),console.log("[AI-PRO] Auto-prediction started (every 1 min, first in 5s)")},generateAutoPrediction(){if(console.log("[AI-PRO] === Auto-prediction attempt ==="),!this.isReady)return void console.log("[AI-PRO] âŒ Skipping: not ready");const e=window.state?.price;if(!e)return void console.log("[AI-PRO] âŒ Skipping: no price data (window.state.price =",e,")");console.log("[AI-PRO] âœ“ Price available:",e);const t=this.config.maxPending||25;this.predictions.pending.length>=t&&this._okrtEnforcePendingCap(t,18e6);const i=this.getCurrentMarketState();console.log("[AI-PRO] Market state:",{price:i.price,hasIndicators:!!i.indicators&&Object.keys(i.indicators||{}).length>0,indicatorKeys:Object.keys(i.indicators||{}).slice(0,5)});const n=this.generateEnsemblePrediction(i);if(console.log("[AI-PRO] Ensemble result:",{direction:n.direction,confidence:(100*n.confidence).toFixed(1)+"%",threshold:100*this.config.minConfidence+"%",passes:n.confidence>=this.config.minConfidence}),n.confidence<.15)return void console.log("[AI-PRO] âŒ Skipping: extremely low confidence");const r="auto_"+Date.now().toString(36)+Math.random().toString(36).substr(2,5),o={id:r,baseId:null,timestamp:Date.now(),price:window.state.price,ensemble:n,features:this.extractFeatureVector(i),regime:n.regime,verifications:[],outcome:null,isAuto:!0};this.predictions.pending.push(o),this._sessionPredictions=(this._sessionPredictions||0)+1,this._lastPredictionTime=Date.now();const s=this.config.horizons.filter(e=>e<=(this.config.autoMaxHorizon||15));for(const e of s)setTimeout(()=>this.verifyProPrediction(r,e),6e4*e);console.log(`[AI-PRO] ðŸŽ¯ Auto-prediction #${this._sessionPredictions}: ${n.direction} @ ${(100*n.confidence).toFixed(1)}% | Price: ${window.state.price.toFixed(4)} | Pending: ${this.predictions.pending.length}`)},_getUidSafe(){try{return window.AILearning?.auth?.currentUser?.uid||("string"==typeof window.AILearning?.user?window.AILearning.user:window.AILearning?.user?.uid)||null}catch(e){return null}},_userDocRef(e){try{const t=this._getUidSafe();if(!t||!this.db||!window.AILearning?.firestore?.doc)return null;const{doc:i}=window.AILearning.firestore;return i(this.db,"aiUsers",t,"engine",e)}catch(e){return null}},_stableStringify(e){const t=new WeakSet,i=e=>{if(null==e)return e;if("object"!=typeof e)return e;if(t.has(e))return null;if(t.add(e),Array.isArray(e))return e.map(i);const n={};for(const t of Object.keys(e).sort())n[t]=i(e[t]);return n};return JSON.stringify(i(e))},_sig(e){try{return this._stableStringify(e)}catch(e){return""}},_sanitizeState(){try{const e=["momentum","trend","volume","structure","patterns","mtf"];for(const t of e){const e=this.models?.[t];if(!e)continue;const i=Number(e.weight);e.weight=Number.isFinite(i)&&i>=0?Math.min(100,i):1;const n=Number(e.accuracy);e.accuracy=Number.isFinite(n)&&n>=0&&n<=1?n:.5;const r=Number(e.predictions);e.predictions=Number.isFinite(r)&&r>=0?Math.floor(r):0;const o=Number(e.correct);e.correct=Number.isFinite(o)&&o>=0?Math.floor(o):0}const t=[2,5,10,15,30,60,120,240];this.predictions=this.predictions||{},this.predictions.byHorizon=this.predictions.byHorizon||{};for(const e of t){const t=this.predictions.byHorizon[e]||this.predictions.byHorizon[String(e)]||{},i=Number(t.total),n=Number(t.correct),r=Number(t.accuracy),o=Number.isFinite(i)&&i>=0?i:0,s=Number.isFinite(n)&&n>=0?n:0,c=Number.isFinite(r)&&r>=0&&r<=1?r:o>0?s/o:.5;this.predictions.byHorizon[e]={total:o,correct:s,accuracy:c}}Array.isArray(this.predictions.pending)||(this.predictions.pending=[]);for(const e of this.predictions.pending)e&&!Number.isFinite(Number(e.timestamp))&&(e.timestamp=Date.now());Array.isArray(this.memory?.patterns)||(this.memory.patterns=[]),("object"!=typeof this.memory?.correlations||null===this.memory.correlations||Array.isArray(this.memory.correlations))&&(this.memory.correlations={})}catch(e){}},_okrtEnforcePendingCap(e=25,t=18e6){try{if(!this.predictions||!Array.isArray(this.predictions.pending))return;const i=Date.now();let n=this.predictions.pending.filter(e=>e&&"object"==typeof e&&e.timestamp&&i-e.timestamp<t);if(n.sort((e,t)=>(e.timestamp||0)-(t.timestamp||0)),n.length>e){const t=n.length-e;n=n.slice(-e),console.log(`[AI-PRO] Pending cap: dropped ${t} oldest (kept ${n.length}, cap ${e})`)}this.predictions.pending=n}catch(e){}},async _maybeSetDoc(e,t){const i=Date.now();if(this._fsDisabledUntil&&i<this._fsDisabledUntil)return!1;const n=this._userDocRef(e);if(!n||!window.AILearning?.firestore?.setDoc)return!1;this._lastDocSigs=this._lastDocSigs||{};const r=this._sig(t);if(r&&this._lastDocSigs[e]===r)return!1;try{const{setDoc:i}=window.AILearning.firestore;return await i(n,t),r&&(this._lastDocSigs[e]=r),!0}catch(e){throw("permission-denied"===(e?.code||"")||String(e?.message||"").includes("Missing or insufficient permissions"))&&(this._fsDisabledUntil=i+12e4),e}},async loadState(){if(this.db)try{const{getDoc:e}=window.AILearning.firestore,t=this._userDocRef("pro_models");if(t){const i=await e(t);if(i.exists()){const e=i.data(),t=["momentum","trend","volume","structure","patterns","mtf"];for(const i of t){const t=e?.[i];t&&this.models?.[i]&&Object.assign(this.models[i],t)}}}const i=this._userDocRef("pro_memory");if(i){const t=await e(i);if(t.exists()){const e=t.data()||{};e.patterns&&Array.isArray(e.patterns)&&(this.memory.patterns=e.patterns),e.correlations&&"object"==typeof e.correlations&&(this.memory.correlations=e.correlations)}}const n=this._userDocRef("pro_performance");if(n){const t=await e(n);if(t.exists()){const e=t.data();e&&"object"==typeof e&&Object.assign(this.performance,e)}}const r=this._userDocRef("pro_horizons");if(r){const t=await e(r);if(t.exists()){const e=t.data()||{},i=["2","5","10","15","30","60","120","240"];for(const t of i){const i=e?.[t];i&&this.predictions.byHorizon?.[t]&&Object.assign(this.predictions.byHorizon[t],i),i&&this.predictions.byHorizon?.[Number(t)]&&Object.assign(this.predictions.byHorizon[Number(t)],i)}}}const o=this._userDocRef("pro_pending");if(o){const t=await e(o);if(t.exists()){const e=t.data()||{};if(e.pending&&Array.isArray(e.pending)){const t=Date.now(),i=this.config.maxPending||25,n=e.pending.filter(e=>e&&"object"==typeof e&&e.timestamp&&t-e.timestamp<18e6).sort((e,t)=>(e.timestamp||0)-(t.timestamp||0)).slice(-i);let r=0;this.predictions.pending=[];for(const e of n)e.id||(e.id=`restored_${e.timestamp||t}_${Math.random().toString(36).slice(2,9)}`),"boolean"!=typeof e.isAuto&&(e.isAuto=!0),this.predictions.pending.push(e),this.rescheduleVerifications(e),r++;e.pending.length>i&&console.log(`[AI-PRO] Pending trimmed on load: ${e.pending.length} -> ${r}`)}}}return this._sanitizeState(),this._okrtEnforcePendingCap(25,18e6),void console.log("[AI-PRO] State loaded from Firestore (scoped)")}catch(e){console.warn("[AI-PRO] Firestore load failed (scoped), using localStorage:",e)}try{const e=localStorage.getItem("ai_pro_state");if(e){const t=JSON.parse(e);if(t.models)for(const[e,i]of Object.entries(t.models))this.models[e]&&Object.assign(this.models[e],i);if(t.memory&&Object.assign(this.memory,t.memory),t.performance&&Object.assign(this.performance,t.performance),t.horizons)for(const[e,i]of Object.entries(t.horizons))this.predictions.byHorizon[e]&&Object.assign(this.predictions.byHorizon[e],i),this.predictions.byHorizon[Number(e)]&&Object.assign(this.predictions.byHorizon[Number(e)],i);if(t.pending&&Array.isArray(t.pending)){this.predictions.pending=t.pending;for(const e of this.predictions.pending)this.rescheduleVerifications(e)}this._sanitizeState(),this._okrtEnforcePendingCap(25,18e6),console.log("[AI-PRO] State loaded from localStorage")}}catch(e){}},async saveState(){try{localStorage.setItem("ai_pro_state",JSON.stringify({models:this.models,memory:{patterns:(this.memory?.patterns||[]).slice(-100),correlations:this.memory?.correlations||{}},performance:this.performance,horizons:this.predictions.byHorizon,pending:(this.predictions?.pending||[]).slice(-25)}))}catch(e){}if(!this.db)return;if(!this._getUidSafe())return;const e=Date.now();if(!(this._fsDisabledUntil&&e<this._fsDisabledUntil))try{this._sanitizeState(),this._okrtEnforcePendingCap(25,18e6);const e=["momentum","trend","volume","structure","patterns","mtf"],t={};for(const i of e){const e=this.models?.[i];if(!e)continue;const n=Number(e.weight),r=Number(e.accuracy),o=Number(e.predictions),s=Number(e.correct);t[i]={weight:Number.isFinite(n)?Math.max(0,Math.min(100,n)):1,accuracy:Number.isFinite(r)?Math.max(0,Math.min(1,r)):.5,predictions:Number.isFinite(o)?Math.max(0,Math.floor(o)):0,correct:Number.isFinite(s)?Math.max(0,Math.floor(s)):0}}const i={patterns:(this.memory?.patterns||[]).slice(-500),correlations:this.memory?.correlations||{},updatedAt:(new Date).toISOString()},n=this.performance,r=["2","5","10","15","30","60","120","240"],o={};for(const e of r){const t=this.predictions?.byHorizon?.[e]??this.predictions?.byHorizon?.[Number(e)];if(!t)continue;const i=Number(t.total),n=Number(t.correct),r=Number(t.accuracy),s=Number.isFinite(i)&&i>=0?i:0,c=Number.isFinite(n)&&n>=0?n:0,a=Number.isFinite(r)&&r>=0&&r<=1?r:s>0?c/s:.5;o[e]={total:s,correct:c,accuracy:a}}const s=[["pro_models",t],["pro_memory",i],["pro_performance",n],["pro_horizons",o],["pro_pending",{pending:(this.predictions?.pending||[]).slice(-25),updatedAt:Date.now()}]];for(const[e,t]of s)try{await this._maybeSetDoc(e,t)}catch(t){console.warn(`[AI-PRO] Firestore save failed (${e}):`,t)}}catch(e){console.warn("[AI-PRO] Firestore save failed (scoped):",e)}},deriveIndicatorsFromState(e,t,i){try{const n=this._getCandlesFromState(e),r=n.length?n[n.length-1]:e.lastCandle||e.candle||e.lastOHLC||null;if(!n.length)return{indicators:e.indicators||{},volume:e.volume,atr:e.atr,atrAvg:e.atrAvg,volatility:e.volatility,lastCandle:r};const o=n.map(e=>this._getCandleClose(e)).filter(e=>Number.isFinite(e)),s=(n.map(e=>this._getCandleHigh(e)).filter(e=>Number.isFinite(e)),n.map(e=>this._getCandleLow(e)).filter(e=>Number.isFinite(e)),n.map(e=>this._getCandleVol(e)).filter(e=>Number.isFinite(e)));if(o.length<20)return{indicators:e.indicators||{},volume:e.volume,atr:e.atr,atrAvg:e.atrAvg,volatility:e.volatility,lastCandle:r};const c=this._calcRSI(o,14),a=this._calcStochRSI(o,14,14),l=this._calcEMA(o,9),u=this._calcEMA(o,21),d=this._calcEMA(o,20),h=this._calcMACD(o,12,26,9),m=this._calcATR(n,14),g=this._calcATR(n,50),f=Number.isFinite(t)?t:o[o.length-1],p=Number.isFinite(m)&&f>0?m/f:0,y=p>.012?"high":p>.006?"normal":"low",b=Math.min(10,o.length-1),_=o[o.length-1-b]||o[0],v=_&&0!==_?(o[o.length-1]-_)/_*100:0,A=this._calcOBV(n),w=l>1.0005*u?"bull":l<.9995*u?"bear":"neutral",P=f>0?Math.abs(l-u)/f:0,M=Math.max(8,Math.min(55,18+800*P)),R="neutral"===w?f>d?"bull":"bear":w;let O=null;if(o.length>=25){const e=o[o.length-1],t=o[o.length-11],i=this._calcRSI(o.slice(0,o.length),14),n=this._calcRSI(o.slice(0,o.length-10),14);Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(n)&&(e<t&&i>n?O={type:"bullish"}:e>t&&i<n&&(O={type:"bearish"}))}const S=s.length?s[s.length-1]:this._getCandleVol(r)||0,N=s.slice(-20),I=N.length?N.reduce((e,t)=>e+t,0)/N.length:S,C={ratio:I>0?S/I:1,trend:S>1.1*I?"increasing":S<.9*I?"decreasing":"stable"},F=Object.assign({},e.indicators||{});return null==F.rsi&&(F.rsi={value:c}),"number"==typeof F.rsi&&(F.rsi={value:F.rsi}),null==F.stochRsi&&(F.stochRsi={value:a}),"number"==typeof F.stochRsi&&(F.stochRsi={value:F.stochRsi}),null==F.macd&&(F.macd={histogram:h.histogram,signal:h.histogram>=0?"bull":"bear"}),"number"==typeof F.macd&&(F.macd={histogram:F.macd,signal:F.macd>=0?"bull":"bear"}),null==F.ema&&(F.ema={emaFast:l,emaSlow:u,ema20:d,signal:w}),null==F.adx&&(F.adx={value:M,trend:w}),null==F.supertrend&&(F.supertrend={signal:R}),null==F.obv&&(F.obv=A),null==F.momentum&&(F.momentum={value:v,signal:v>=0?"bull":"bear"}),O&&null==F.divergence&&(F.divergence=O),"number"!=typeof e.prevPrice&&Number.isFinite(i),{indicators:F,volume:e.volume||C,atr:Number.isFinite(e.atr)?e.atr:m,atrAvg:Number.isFinite(e.atrAvg)?e.atrAvg:g,volatility:e.volatility||y,lastCandle:r}}catch(t){return{indicators:e.indicators||{},volume:e.volume,atr:e.atr,atrAvg:e.atrAvg,volatility:e.volatility,lastCandle:e.lastCandle||e.candle||e.lastOHLC||null}}},_getCandlesFromState:e=>Array.isArray(e.candles)&&e.candles.length?e.candles:Array.isArray(e.ohlc)&&e.ohlc.length?e.ohlc:Array.isArray(e.ohlcHistory)&&e.ohlcHistory.length?e.ohlcHistory:[],_getCandleClose(e){return e?this._num(e.close??e.c??e.C??e[4],NaN):NaN},_getCandleHigh(e){return e?this._num(e.high??e.h??e.H??e[2],NaN):NaN},_getCandleLow(e){return e?this._num(e.low??e.l??e.L??e[3],NaN):NaN},_getCandleVol(e){return e?this._num(e.volume??e.v??e.V??e[5],NaN):NaN},_num(e,t=0){const i="string"==typeof e?parseFloat(e):e;return Number.isFinite(i)?i:t},_calcEMA(e,t){if(!Array.isArray(e)||0===e.length)return NaN;const i=2/(Math.max(2,0|t)+1);let n=e[0];for(let t=1;t<e.length;t++){const r=e[t];Number.isFinite(r)&&(n=r*i+n*(1-i))}return n},_calcRSI(e,t=14){if(!Array.isArray(e)||e.length<t+2)return 50;const i=Math.max(2,0|t);let n=0,r=0;for(let t=e.length-i;t<e.length;t++){const i=e[t-1],o=e[t];if(!Number.isFinite(i)||!Number.isFinite(o))continue;const s=o-i;s>=0?n+=s:r-=s}const o=r/i;if(0===o)return 100;const s=100-100/(1+n/i/o);return Math.max(0,Math.min(100,s))},_calcMACD(e,t=12,i=26,n=9){if(!Array.isArray(e)||e.length<i+n)return{histogram:0};const r=this._calcEMA(e,t)-this._calcEMA(e,i),o=Math.min(60,e.length),s=[];for(let n=e.length-o;n<e.length;n++){const r=e.slice(0,n+1);s.push(this._calcEMA(r,t)-this._calcEMA(r,i))}return{histogram:r-this._calcEMA(s,n)}},_calcATR(e,t=14){if(!Array.isArray(e)||e.length<3)return NaN;const i=Math.max(2,0|t);let n=0,r=0;for(let t=Math.max(1,e.length-i);t<e.length;t++){const i=e[t],o=e[t-1],s=this._getCandleHigh(i),c=this._getCandleLow(i),a=this._getCandleClose(o);[s,c,a].every(Number.isFinite)&&(n+=Math.max(s-c,Math.abs(s-a),Math.abs(c-a)),r++)}return r?n/r:NaN},_calcStochRSI(e,t=14,i=14){if(!Array.isArray(e)||e.length<t+i+2)return 50;const n=[];for(let i=t+1;i<e.length;i++)n.push(this._calcRSI(e.slice(0,i+1),t));const r=n.slice(-i),o=r[r.length-1],s=Math.min(...r),c=Math.max(...r);if(c===s)return 50;const a=(o-s)/(c-s)*100;return Math.max(0,Math.min(100,a))},_calcOBV(e){if(!Array.isArray(e)||e.length<3)return{value:0,signal:"neutral",slope:0};let t=0;for(let i=1;i<e.length;i++){const n=this._getCandleClose(e[i-1]),r=this._getCandleClose(e[i]),o=this._getCandleVol(e[i]);[n,r,o].every(Number.isFinite)&&(r>n?t+=o:r<n&&(t-=o))}const i=Math.min(10,e.length-2);let n=0;for(let t=e.length-i;t<e.length;t++){const i=this._getCandleClose(e[t-1]),r=this._getCandleClose(e[t]),o=this._getCandleVol(e[t]);[i,r,o].every(Number.isFinite)&&(r>i?n+=o:r<i&&(n-=o))}return{value:t,signal:n>0?"bull":n<0?"bear":"neutral",slope:n}},getCurrentMarketState(){const e=window.state||{},t="number"==typeof e.price?e.price:"number"==typeof e.currentPrice?e.currentPrice:"number"==typeof e.lastPrice?e.lastPrice:0,i="number"==typeof e.prevPrice?e.prevPrice:"number"==typeof this._lastPriceSeen?this._lastPriceSeen:t;Number.isFinite(t)&&(this._lastPriceSeen=t);const n=Date.now();if(!this._derivedCache||n-this._derivedCache.ts>750){const r=this.deriveIndicatorsFromState(e,t,i);this._derivedCache=Object.assign({ts:n},r)}const r=this._derivedCache||{};return{price:t,prevPrice:i,indicators:r.indicators||e.indicators||{},indicatorKeys:Object.keys(r.indicators||e.indicators||{}),volume:r.volume||e.volume,cvd:e.cvd,whaleFlow:e.whaleFlow,supportResistance:e.supportResistance,orderBlocks:e.orderBlocks,fvg:e.fvg,liquidity:e.liquidity,patterns:e.patterns,chartPattern:e.chartPattern,divergence:e.divergence||r.indicators&&r.indicators.divergence||null,mtf:e.mtf,volatility:r.volatility||e.volatility,atr:r.atr??e.atr,atrAvg:r.atrAvg??e.atrAvg,lastCandle:r.lastCandle||e.lastCandle||e.candle||e.lastOHLC||null,orderbook:e.orderbook||e.depth||null}},getPrediction(){const e=this.getCurrentMarketState();return this.generateEnsemblePrediction(e)},getModelStats(){const e={};for(const[t,i]of Object.entries(this.models))e[t]={weight:i.weight.toFixed(2),accuracy:(100*i.accuracy).toFixed(1)+"%",predictions:i.predictions};return e},getStats(){const e=this.performance?.overall||{accuracy:0,totalPredictions:0,correctPredictions:0},t=this.performance?.daily||{},i=this.predictions?.byHorizon||{},n={};for(const[e,t]of Object.entries(i))n[e]={accuracy:"number"==typeof t?.accuracy?t.accuracy:0,total:"number"==typeof t?.total?t.total:0,correct:"number"==typeof t?.correct?t.correct:0};const r=Array.isArray(this.config.shortHorizons)?this.config.shortHorizons:[2,5,10,15];let o=0,s=0;for(const e of r){const t=i?.[e];t&&(o+="number"==typeof t.total?t.total:0,s+="number"==typeof t.correct?t.correct:0)}const c={...e};0===(c.totalPredictions||0)&&o>0&&(c.totalPredictions=o,c.correctPredictions=s,c.accuracy=s/o);const a=this.predictions?.completed?.length||0,l=this.performance?.overall?.totalPredictions||0,u=o,d=Math.max(a,l,u),h=this._sessionStart||Date.now(),m=Math.max(0,Math.floor((Date.now()-h)/6e4));return{overall:c,daily:t,session:{predictions:this._sessionPredictions||0,uptime:m,lastVerification:this._lastVerification||null},horizons:n,memory:{patterns:this.memory?.patterns?.length||0,pending:this.predictions?.pending?.length||0,completed:d},models:"function"==typeof this.getModelStats?this.getModelStats():{}}},forceSave(){return this.saveState()},debugFeatures(){const e=this.getCurrentMarketState(),t=this.extractFeatureVector(e);return console.log("[AI-PRO] Feature vector:",t),console.log("[AI-PRO] Features extracted:",Object.keys(t).length),t}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>AIEnginePro.init(),2e3)}):setTimeout(()=>AIEnginePro.init(),2e3),window.AIEnginePro=AIEnginePro,console.log("[AI-PRO] AI Engine PRO v1.6.9 loaded (always-active mode)");