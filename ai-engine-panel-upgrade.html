<!-- ============================================
     AI ENGINE PRO - PANEL MEJORADO v1.0
     OkrtSystem Labs
     
     INSTRUCCIONES:
     1. Busca en index.html el panel actual (busca "AI ENGINE PRO")
     2. Reemplaza el <div class="panel"> completo con el HTML de abajo
     3. Reemplaza la funciÃ³n updateAIEnginePanel() con el JS de abajo
     ============================================ -->

<!-- ==================== HTML DEL PANEL ==================== -->
<!-- Reemplaza el panel existente de AI ENGINE PRO con este -->

<div class="panel" id="aiEnginePanel">
  <div class="panel-head" style="display:flex; justify-content:space-between; align-items:center;">
    <span>ðŸ§  AI ENGINE PRO</span>
    <span id="aiVersion" style="font-size:8px; color:var(--text-dim);">v1.3.0</span>
  </div>
  <div style="padding:8px; font-family:var(--font-data); font-size:10px;">
    <!-- Status Row -->
    <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
      <span style="color:var(--text-dim);">Status:</span>
      <span id="aiStatus" class="c-yellow">INIT...</span>
    </div>
    
    <!-- Current Prediction -->
    <div id="aiCurrentPrediction" style="background:rgba(0,212,255,0.1); border-radius:4px; padding:6px; margin:6px 0; display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span id="aiDirection" style="font-weight:bold; font-size:12px;">--</span>
        <span id="aiConfidence" style="font-size:11px;">--</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:4px; font-size:9px; color:var(--text-dim);">
        <span>Regime: <span id="aiRegime">--</span></span>
        <span>Session: <span id="aiSession">--</span></span>
      </div>
    </div>
    
    <!-- Accuracy Bar -->
    <div style="margin:6px 0;">
      <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
        <span style="color:var(--text-dim);">Accuracy:</span>
        <span id="aiAccuracy" class="c-cyan">0.0%</span>
      </div>
      <div style="height:4px; background:rgba(255,255,255,0.1); border-radius:2px; overflow:hidden;">
        <div id="aiAccuracyBar" style="height:100%; width:0%; background:linear-gradient(90deg, var(--accent-red), var(--accent-yellow), var(--accent-green)); transition:width 0.5s;"></div>
      </div>
    </div>
    
    <!-- Stats Grid -->
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; margin:6px 0;">
      <div style="background:rgba(168,85,247,0.15); padding:4px 6px; border-radius:3px;">
        <div style="font-size:8px; color:var(--text-dim);">Patterns</div>
        <div id="aiPatterns" class="c-purple" style="font-size:12px; font-weight:bold;">0</div>
      </div>
      <div style="background:rgba(0,212,255,0.1); padding:4px 6px; border-radius:3px;">
        <div style="font-size:8px; color:var(--text-dim);">Pending</div>
        <div id="aiPending" class="c-cyan" style="font-size:12px; font-weight:bold;">0</div>
      </div>
      <div style="background:rgba(0,255,136,0.1); padding:4px 6px; border-radius:3px;">
        <div style="font-size:8px; color:var(--text-dim);">Total Preds</div>
        <div id="aiTotalPreds" class="c-green" style="font-size:12px; font-weight:bold;">0</div>
      </div>
      <div style="background:rgba(255,149,0,0.1); padding:4px 6px; border-radius:3px;">
        <div style="font-size:8px; color:var(--text-dim);">Win Rate</div>
        <div id="aiWinRate" class="c-orange" style="font-size:12px; font-weight:bold;">--</div>
      </div>
    </div>
    
    <!-- Best Horizons -->
    <div style="margin-top:6px;">
      <div style="font-size:8px; color:var(--text-dim); margin-bottom:3px;">Best Horizons:</div>
      <div id="aiHorizonsGrid" style="display:flex; flex-wrap:wrap; gap:3px;">
        <!-- Se llena dinÃ¡micamente -->
      </div>
    </div>
    
    <!-- Model Performance (collapsible) -->
    <details style="margin-top:6px;">
      <summary style="font-size:9px; color:var(--text-dim); cursor:pointer; user-select:none;">Model Performance â–¼</summary>
      <div id="aiModelsGrid" style="margin-top:4px; display:grid; grid-template-columns:1fr 1fr; gap:2px; font-size:8px;">
        <!-- Se llena dinÃ¡micamente -->
      </div>
    </details>
    
    <!-- Last Update -->
    <div style="margin-top:6px; text-align:right; font-size:8px; color:var(--text-dim);">
      Updated: <span id="aiLastUpdate">--</span>
    </div>
  </div>
</div>


<!-- ==================== JAVASCRIPT ==================== -->
<!-- Reemplaza la funciÃ³n updateAIEnginePanel existente con este cÃ³digo -->
<!-- Busca el bloque que empieza con "// AI ENGINE PRO STATUS PANEL UPDATE" -->

<script>
// ============================================
// AI ENGINE PRO STATUS PANEL UPDATE - ENHANCED
// ============================================
(function() {
  let lastPrediction = null;
  let updateCount = 0;
  
  function updateAIEnginePanel() {
    updateCount++;
    
    // Check if AIEnginePro is ready
    if (!window.AIEnginePro || !window.AIEnginePro.isReady) {
      const statusEl = document.getElementById('aiStatus');
      if (statusEl) {
        statusEl.textContent = 'LOADING...';
        statusEl.className = 'c-yellow';
      }
      return;
    }
    
    try {
      const stats = window.AIEnginePro.getStats();
      const currentPred = window.AIEnginePro.getPrediction ? window.AIEnginePro.getPrediction() : null;
      
      // Version
      const versionEl = document.getElementById('aiVersion');
      if (versionEl && window.AIEnginePro.version) {
        versionEl.textContent = 'v' + window.AIEnginePro.version;
      }
      
      // Status
      const statusEl = document.getElementById('aiStatus');
      if (statusEl) {
        const pending = stats.memory?.pending || 0;
        if (pending > 0) {
          statusEl.textContent = 'LEARNING';
          statusEl.className = 'c-cyan';
        } else {
          statusEl.textContent = 'READY';
          statusEl.className = 'c-green';
        }
      }
      
      // Current Prediction Box
      const predBox = document.getElementById('aiCurrentPrediction');
      if (predBox && currentPred) {
        predBox.style.display = 'block';
        
        const dirEl = document.getElementById('aiDirection');
        const confEl = document.getElementById('aiConfidence');
        const regimeEl = document.getElementById('aiRegime');
        const sessionEl = document.getElementById('aiSession');
        
        if (dirEl) {
          const dir = currentPred.direction || 'NEUTRAL';
          dirEl.textContent = dir === 'BULL' ? 'ðŸŸ¢ BULL' : dir === 'BEAR' ? 'ðŸ”´ BEAR' : 'âšª NEUTRAL';
          dirEl.style.color = dir === 'BULL' ? 'var(--accent-green)' : dir === 'BEAR' ? 'var(--accent-red)' : 'var(--text-dim)';
        }
        
        if (confEl) {
          const conf = (currentPred.confidence || 0) * 100;
          confEl.textContent = conf.toFixed(1) + '%';
          confEl.style.color = conf >= 70 ? 'var(--accent-green)' : conf >= 55 ? 'var(--accent-cyan)' : 'var(--text-dim)';
        }
        
        if (regimeEl) {
          const regime = currentPred.regime || 'unknown';
          const regimeDisplay = {
            'trending_up': 'ðŸ“ˆ Trendâ†‘',
            'trending_down': 'ðŸ“‰ Trendâ†“',
            'ranging': 'â†”ï¸ Range',
            'volatile': 'âš¡ Volatile'
          };
          regimeEl.textContent = regimeDisplay[regime] || regime;
        }
        
        if (sessionEl) {
          const session = currentPred.session || window.AIEnginePro.getSessionContext?.() || '--';
          const sessionDisplay = { 'ASIA': 'ðŸŒ Asia', 'EUROPE': 'ðŸŒ EU', 'US': 'ðŸŒŽ US' };
          sessionEl.textContent = sessionDisplay[session] || session;
        }
        
        // Update prediction box color based on direction
        const dir = currentPred.direction || 'NEUTRAL';
        if (dir === 'BULL') {
          predBox.style.background = 'rgba(0,255,136,0.1)';
          predBox.style.borderLeft = '3px solid var(--accent-green)';
        } else if (dir === 'BEAR') {
          predBox.style.background = 'rgba(255,68,102,0.1)';
          predBox.style.borderLeft = '3px solid var(--accent-red)';
        } else {
          predBox.style.background = 'rgba(0,212,255,0.1)';
          predBox.style.borderLeft = '3px solid var(--text-dim)';
        }
      }
      
      // Accuracy with bar
      const accEl = document.getElementById('aiAccuracy');
      const accBar = document.getElementById('aiAccuracyBar');
      if (accEl && stats.overall) {
        const acc = stats.overall.accuracy || 0;
        const accPct = (acc * 100).toFixed(1);
        accEl.textContent = accPct + '%';
        accEl.className = acc >= 0.55 ? 'c-green' : acc >= 0.45 ? 'c-cyan' : 'c-red';
        
        if (accBar) {
          accBar.style.width = Math.min(100, acc * 100) + '%';
        }
      }
      
      // Patterns
      const patEl = document.getElementById('aiPatterns');
      if (patEl && stats.memory) {
        patEl.textContent = stats.memory.patterns || 0;
      }
      
      // Pending
      const pendEl = document.getElementById('aiPending');
      if (pendEl && stats.memory) {
        const pending = stats.memory.pending || 0;
        pendEl.textContent = pending;
        pendEl.className = pending > 30 ? 'c-orange' : pending > 0 ? 'c-cyan' : 'c-dim';
      }
      
      // Total Predictions
      const totalEl = document.getElementById('aiTotalPreds');
      if (totalEl && stats.overall) {
        totalEl.textContent = stats.overall.totalPredictions || 0;
      }
      
      // Win Rate (correct/total)
      const winEl = document.getElementById('aiWinRate');
      if (winEl && stats.overall) {
        const total = stats.overall.totalPredictions || 0;
        const correct = stats.overall.correctPredictions || 0;
        if (total > 0) {
          const rate = (correct / total * 100).toFixed(0);
          winEl.textContent = correct + '/' + total + ' (' + rate + '%)';
        } else {
          winEl.textContent = '--';
        }
      }
      
      // Horizons Grid
      const horizonsGrid = document.getElementById('aiHorizonsGrid');
      if (horizonsGrid && stats.horizons) {
        let html = '';
        const sortedHorizons = Object.entries(stats.horizons)
          .filter(([h, d]) => d.total >= 3)
          .sort((a, b) => b[1].accuracy - a[1].accuracy);
        
        if (sortedHorizons.length === 0) {
          html = '<span style="color:var(--text-dim); font-size:8px;">No data yet...</span>';
        } else {
          sortedHorizons.slice(0, 4).forEach(([h, data]) => {
            const acc = (data.accuracy * 100).toFixed(0);
            const color = data.accuracy >= 0.55 ? 'var(--accent-green)' : 
                         data.accuracy >= 0.45 ? 'var(--accent-cyan)' : 'var(--accent-red)';
            html += `<div style="background:rgba(255,255,255,0.05); padding:2px 5px; border-radius:3px; font-size:8px;">
              <span style="color:var(--text-dim);">${h}m:</span>
              <span style="color:${color}; font-weight:bold;">${acc}%</span>
              <span style="color:var(--text-dim); font-size:7px;">(${data.total})</span>
            </div>`;
          });
        }
        horizonsGrid.innerHTML = html;
      }
      
      // Models Grid (for the expandable section)
      const modelsGrid = document.getElementById('aiModelsGrid');
      if (modelsGrid && stats.models) {
        let html = '';
        for (const [name, data] of Object.entries(stats.models)) {
          const accNum = parseFloat(data.accuracy);
          const color = accNum >= 55 ? 'var(--accent-green)' : 
                       accNum >= 45 ? 'var(--text-dim)' : 'var(--accent-red)';
          html += `<div style="display:flex; justify-content:space-between; padding:2px 4px; background:rgba(255,255,255,0.03); border-radius:2px;">
            <span style="color:var(--text-dim);">${name}</span>
            <span style="color:${color};">${data.accuracy}</span>
          </div>`;
        }
        modelsGrid.innerHTML = html;
      }
      
      // Last Update timestamp
      const updateEl = document.getElementById('aiLastUpdate');
      if (updateEl) {
        const now = new Date();
        updateEl.textContent = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      }
      
    } catch (e) {
      console.warn('[UI] AI Panel update error:', e);
    }
  }
  
  // Update every 3 seconds (more responsive)
  setInterval(updateAIEnginePanel, 3000);
  // Initial update after 3 seconds
  setTimeout(updateAIEnginePanel, 3000);
})();
</script>
